function isNull(a){return a===null;}
function isUndefined(a){return a===undefined;}
function isNullOrUndefined(a){return isNull(a)||isUndefined(a);}
function numberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");}
function numberFormat(labelValue,i){return Math.abs(Number(labelValue))>=1.0e+9?i===0?parseFloat((Math.abs(Number(labelValue))/1.0e+9).toFixed(2)):parseFloat((Math.abs(Number(labelValue))/1.0e+9).toFixed(2))+" b":Math.abs(Number(labelValue))>=1.0e+6?i===0?parseFloat((Math.abs(Number(labelValue))/1.0e+6).toFixed(2)):parseFloat((Math.abs(Number(labelValue))/1.0e+6).toFixed(2))+" m":Math.abs(Number(labelValue))>=1.0e+3?i===0?parseFloat((Math.abs(Number(labelValue))/1.0e+3).toFixed(2)):parseFloat((Math.abs(Number(labelValue))/1.0e+3).toFixed(2))+" k":Math.abs(Number(labelValue));}
var simulateClick=function(elem){var rect=elem.getBoundingClientRect(),topEnter=rect.top,leftEnter=rect.left,topMid=Math.floor(Math.random()*(rect.bottom-rect.top+1))+rect.top,leftMid=Math.floor(Math.random()*(rect.right-rect.left+1))+rect.left,ddelay=(rect.height+rect.width)*0.1,ducInit={bubbles:true,clientX:leftMid,clientY:topMid},mover=new MouseEvent('mouseover',{bubbles:true,clientX:leftEnter,clientY:topEnter}),mdown=new MouseEvent('mousedown',ducInit),mup=new MouseEvent('mouseup',ducInit),mclick=new MouseEvent('click',ducInit);elem.dispatchEvent(mover);window.setTimeout(function(){elem.dispatchEvent(mdown)},ddelay);window.setTimeout(function(){elem.dispatchEvent(mup);elem.dispatchEvent(mclick);},ddelay*1.2);delete rect,topEnter,leftEnter,topMid,leftMid,ddelay,ducInit,mover,mdown,mup,mclick;}
function pCA(){var c='div.btn-lock.lock1';var c1='div.btn-lock.lock0';!isNullOrUndefined(document.querySelector(c))?simulateClick(document.querySelector(c)):null;!isNullOrUndefined(document.querySelector(c1))?simulateClick(document.querySelector(c1)):null;delete c,c1;}
function pResetBonus(){var resetMarkBtn=document.querySelector("div.prt-bonus-reset-button.btn-bonus-reset.weapon");!isNullOrUndefined(resetMarkBtn)?simulateClick(resetMarkBtn):null;delete resetMarkBtn;}
function pSpaceBar(e){var buttons=['div.btn-usual-ok','div.btn-settle','div.btn-synthesis','div.btn-usual-text.exchange','div.btn-usual-text.buy','div.btn-evolution.active','div.btn-use-item','div.btn-follow-again','div.btn-usual-exchange',"div.btn-move-division","div.btn-usual-close"];var elem;var queue=[];buttons.forEach(function(value,i){var a=document.querySelector(value);if(!isNullOrUndefined(a)){if(i===0){queue.unshift(value);}else{queue.push(value);}}
delete a;});if(queue.length>0){if(queue[0]===buttons[0]&&!isNullOrUndefined(document.querySelector(queue[0]))){elem=document.querySelector(queue[0]).className==="btn-usual-ok btn-ability-use"?document.querySelectorAll(queue[0])[1]:document.querySelector(queue[0]);}else{queue.forEach(function(value,i){if(!isNullOrUndefined(document.querySelector(value))){elem=document.querySelector(value);}else if(value==="div.btn-evolution.active"){elem=document.querySelector("#btn-evolution");}});}}
if(!isNullOrUndefined(elem.getBoundingClientRect)){isNullOrUndefined(document.querySelector('div.onm-anim-mask'))?simulateClick(elem):getComputedStyle(document.querySelector('div.onm-anim-mask')).getPropertyValue('display')==="none"?simulateClick(elem):simulateClick(document.querySelector('div.onm-anim-mask'));}}
function showSkillCD(){var charaSkillDetails=document.querySelectorAll('[ability-id]');var cdCharaSkills=[];for(i=0;i<=3;i++){var currentChara={skills:[]}
charaSkillDetails.forEach(function(value,index){if(value.outerHTML===document.querySelector("div.btn-usual-ok.btn-ability-use").outerHTML){}else if((value.outerHTML.includes("ability-character-num-"+(i+1))===true)){if(!isNullOrUndefined(value.getAttribute("ability-recast"))){currentChara.skills.push(value.getAttribute("ability-recast"))}}});cdCharaSkills.push(currentChara);delete currentChara;}
delete charaSkillDetails;var cdSkillMini=[];document.querySelectorAll('div.prt-ability-state').forEach(function(value,index){if(index<=3){cdSkillMini.push(value);}});cdSkillMini.forEach(function(value,index){var skCount=0;document.querySelectorAll('div.prt-ability-state')[index].childNodes.forEach(function(childVal,childIndex){if((childIndex%2)===1){var coolDown=cdCharaSkills[index].skills[skCount];if(!isNullOrUndefined(coolDown)){if(coolDown==='0'){coolDown="";}
childVal.innerHTML='<p style="position: relative;color:black;font-weight:bold;font-size: 6px;text-align: center;top: -4px;text-shadow: 0 0 10px #ffffff, 0 0 10px #ffffff;">'+coolDown+'</p>';}
skCount++;delete coolDown;}});delete skCount;});delete cdSkillMini,cdCharaSkills;}
function showBossHP(){try{var a=stage.pJsnData.boss;var enemyId=-1;document.querySelectorAll("div.prt-gauge-area")[0].childNodes.forEach(function(enemy,eIndex){if(!isNullOrUndefined(enemy.className)&&enemy.classList.contains("prt-enemy-percent")){enemyId++;var newStr=numberWithCommas(numberFormat(a.param[enemyId].hp,1)+" / "+numberFormat(a.param[enemyId].hpmax),1);var accPercHP=((a.param[enemyId].hp/a.param[enemyId].hpmax)*100).toFixed(1);var stillAlive=a.number;a.param.forEach(function(e,i){if(e.alive===0){stillAlive--;}});if(stillAlive>1){enemy.childNodes[1].innerText=accPercHP+"%"+"\n ("+newStr+")";enemy.childNodes[1].style.cssText="text-shadow: 0 0 1px #731400, 0 0 1px #731400, 0 0 1px #731400, 0 0 1px #731400, 0 0 2px #731400, 0 0 2px #731400, 0 0 2px #731400, 0 0 2px #731400; display: -webkit-box; margin: -34px 0 0 -20px; font-size:12px; width: 200px !important";}else{enemy.childNodes[1].innerText=accPercHP+"%"+" ("+newStr+")";enemy.childNodes[1].style.cssText="text-shadow: 0 0 1px #731400, 0 0 1px #731400, 0 0 1px #731400, 0 0 1px #731400, 0 0 2px #731400, 0 0 2px #731400, 0 0 2px #731400, 0 0 2px #731400; display: -webkit-box; margin: -6px 0 0 70px; font-size:15px; width: 300px !important";}
delete newStr,accPercHP,stillAlive;}});delete a,enemyId;}catch(e){if(e instanceof ReferenceError){};}}
function loadTracker(type){if(type==="Supply"){var items=document.querySelectorAll("div.lis-item.se");items.forEach(function(item,i){var tracker=document.createElement("div");tracker.className="keimateTracker"
var result=yeet.filter(obj=>{return obj.dataIndex===item.getAttribute("data-index");});if(result.length>0){tracker.className="keimateTracked"}
item.appendChild(tracker);delete tracker,result;});delete items;}else if(type==="Update"){var checkTracker=localStorage.getItem("itemTrackingList")===null?[]:JSON.parse(localStorage.getItem("itemTrackingList"));document.querySelectorAll("[class*='keimateTrack'").forEach(function(item,i){if(i%2!==0){var result=checkTracker.filter(obj=>{return obj.dataIndex===item.parentElement.getAttribute("data-index");});if(result.length>0){item.className="keimateTracked"}else if(result.length<1){item.className="keimateTracker";}
delete result;}});delete checkTracker;}}
document.addEventListener('keydown',function(e){if(e.which===32){e.preventDefault();e.stopPropagation();}
if(e.keyCode===32){pSpaceBar(e);}
if(e.keyCode===67){pCA();}
if(e.keyCode===82){pResetBonus();}});var observer=new MutationObserver(function(mutations){try{showSkillCD();showBossHP();}catch(e){if(e instanceof ReferenceError){};}});var config={attributes:true,childList:true,characterData:true};var ready=function(){if(window.location.href.indexOf("http://game.granbluefantasy.jp/#raid_multi/")>-1||window.location.href.indexOf("http://game.granbluefantasy.jp/#raid/")>-1){if(document.querySelectorAll('[ability-id]').length>0&&document.querySelectorAll("div.prt-gauge-area")[0].childNodes.length>0){document.querySelectorAll('[ability-id]').forEach(function(val,index){observer.observe(val,{attributes:true,childList:true,characterData:true});});document.querySelectorAll("[id^=enemy-hp]").forEach(function(val,index){observer.observe(val,{attributes:true,childList:true,characterData:true});});document.querySelectorAll("a").forEach(function(val,index){if(val.className.includes("enemy")){val.style.cssText="display: inline-block;cursor:pointer;"}});try{showSkillCD();showBossHP();return;}catch(e){if(e instanceof ReferenceError){};}}}else if(window.location.href==="http://game.granbluefantasy.jp/#item"&&document.querySelectorAll("div.lis-item.se").length>0){return;}else if(window.location.href.indexOf("http://game.granbluefantasy.jp/#casino/game/poker/")>-1){if(!isNullOrUndefined(document.querySelector("div.prt-start-shine"))){observer.observe(document.querySelector("div.prt-start-shine"),{attributes:true,childList:true,characterData:true});var Deck=[];for(i=1;i<5;i++){for(j=1;j<14;j++){var w=j<8?0:1;if(j==1){w=1;}
Deck.push(new Card(i,w,j));}}
console.log(Deck);return;}}
window.requestAnimationFrame(ready);};window.requestAnimationFrame(ready);class Card{constructor(i,w,v){this.type=i;this.weight=w;this.val=v;}
type(){return this.type;}
weight(){return this.weight;}
val(){return this.val;}
toString(){return"Type: "+this.type+" Weight: "+this.weight+" Value: "+this.val;}}
function cardType(c){return c==1?"Spades":c==2?"Clubs":c==3?"Hearts":c==4?"Diamond":"Lolno";}
function isRoyal(i){return i==1?"Ace":i==11?"Jack":i==12?"Queen":i==13?"King":"Lolno";}
function rates(d,i){var high=0;var low=0;d.forEach(function(a,i){if(a.weight==0){low++;}else{high++;}});return i==0?(low/(low+high))*100:(high/(low+high))*100;}
window.onblur=function(){forciblyMuted=false;newList.play();globalList.takeAll(newList);globalList.play();};class AudioList{constructor(webAudioPlayFunc,webAudioPauseFunc,audioElPlayFunc,audioElPauseFunc){this._webAudioContexts=[];this._audioElements=[];this._webAudioPlayFunc=webAudioPlayFunc;this._webAudioPauseFunc=webAudioPauseFunc;this._audioElPlayFunc=audioElPlayFunc;this._audioElPauseFunc=audioElPauseFunc;}
addWebAudioContext(ctx){this._webAudioContexts.push(ctx);}
addAudioElement(el){this._audioElements.push(el);}
takeAll(other){this._webAudioContexts=this._webAudioContexts.concat(other._webAudioContexts);this._audioElements=this._audioElements.concat(other._audioElements);other._webAudioContexts=[];other._audioElements=[];}
length(){return this._webAudioContexts.length+this._audioElements.length;}
_runOnAll(webAudioFunc,audioElFunc){this._webAudioContexts.forEach(el=>{webAudioFunc.call(el);});this._audioElements.forEach(el=>{audioElFunc.call(el);});}
play(){this._runOnAll(this._webAudioPlayFunc,this._audioElPlayFunc);}
pause(){this._runOnAll(this._webAudioPauseFunc,this._audioElPauseFunc);}}
const realPlay=window.Audio.prototype.play;const realPause=window.Audio.prototype.pause;const realSuspend=window.AudioContext.prototype.suspend;const realResume=window.AudioContext.prototype.resume;let globalList=new AudioList(realResume,realSuspend,realPlay,realPause);let newList=new AudioList(realResume,realSuspend,realPlay,realPause);let forciblyMuted=false;window.Audio.prototype.play=function(){if(forciblyMuted){return Promise.reject(new DOMException('Audio forcibly muted by unmute extension'));}
return realPlay.call(this).catch(err=>{throw err;});};window.Audio=new Proxy(window.Audio,{construct(target,args){const result=new target(...args);newList.addAudioElement(result);return result;}});const origCreateElement=window.document.createElement;window.document.createElement=function(type){if(type!='audio'){return origCreateElement.call(this,type);}
return new Audio();};window.AudioContext.prototype.resume=function(){if(forciblyMuted){console.log('AudioContexts forcibly muted by unmute extension');return Promise.resolve();}
return realResume.call(this);};window.AudioContext=new Proxy(window.AudioContext,{construct(target,args){const result=new target(...args);newList.addWebAudioContext(result);if(result.state!=='running'){}
return result;}});