function isNullOrUndefined(b){return(b===null)||(b===undefined)}function numberWithCommas(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function numberFormat(a,b){return Math.abs(Number(a))>=1000000000?b===0?parseFloat((Math.abs(Number(a))/1000000000).toFixed(2)):parseFloat((Math.abs(Number(a))/1000000000).toFixed(2))+" b":Math.abs(Number(a))>=1000000?b===0?parseFloat((Math.abs(Number(a))/1000000).toFixed(2)):parseFloat((Math.abs(Number(a))/1000000).toFixed(2))+" m":Math.abs(Number(a))>=1000?b===0?parseFloat((Math.abs(Number(a))/1000).toFixed(2)):parseFloat((Math.abs(Number(a))/1000).toFixed(2))+" k":Math.abs(Number(a))}function random(b,a){return Math.floor(Math.random()*(a-b+1))+b}function isCombat(){return window.location.hash.indexOf("#raid_multi/")>-1||window.location.hash.indexOf("#raid/")>-1}var simulateClick=function(f){try{var m=f.getBoundingClientRect(),d=m.top,n=m.left,j=random(m.bottom,m.top),i=random(m.right,m.left),c=(m.height+m.width)*0.1,l={bubbles:true,clientX:i,clientY:j},b=new MouseEvent("mouseover",{bubbles:true,clientX:n,clientY:d}),h=new MouseEvent("mousedown",l),a=new MouseEvent("mouseup",l),g=new MouseEvent("click",l);f.dispatchEvent(b);window.setTimeout(function(){f.dispatchEvent(h)},c);window.setTimeout(function(){f.dispatchEvent(a);f.dispatchEvent(g)},c*random(0.99,1.2))}catch(k){}};function pCA(){if(!isCombat()){return}var b=document.querySelector("div.btn-lock.lock1");var a=document.querySelector("div.btn-lock.lock0");!isNullOrUndefined(b)?simulateClick(b):null;!isNullOrUndefined(a)?simulateClick(a):null}function pResetBonus(){var a=document.querySelector("div.prt-bonus-reset-button.btn-bonus-reset.weapon");!isNullOrUndefined(a)?simulateClick(a):null}function pSpaceBar(h){var g=["div.btn-usual-ok","div.btn-usual-ok.btn-summon-use","div.btn-settle","div.btn-synthesis","div.btn-usual-text.exchange","div.btn-usual-text.buy","div.btn-evolution.active","div.btn-use-item","div.btn-follow-again","div.btn-usual-exchange","div.btn-move-division","div.btn-usual-close"];var f;var b=[];for(var d=0;d<g.length;d++){var c=document.querySelector(g[d]);if(!isNullOrUndefined(c)){if(d===0){b.unshift(g[d])}else{b.push(g[d])}}}if(b.length>0){if(b[0]===g[0]&&!isNullOrUndefined(document.querySelector(b[0]))){f=document.querySelector(b[0]).className.includes("btn-usual-ok")?document.querySelector(b[0]):document.querySelectorAll(b[0])[1]}else{for(var d=0;d<b.length;d++){if(!isNullOrUndefined(document.querySelector(b[d]))){f=document.querySelector(b[d])}else{if(b[d]==="div.btn-evolution.active"){f=document.querySelector("#btn-evolution")}}}}}if(!isNullOrUndefined(f)){isNullOrUndefined(document.querySelector("div.onm-anim-mask"))?simulateClick(f):getComputedStyle(document.querySelector("div.onm-anim-mask")).getPropertyValue("display")==="none"?simulateClick(f):simulateClick(document.querySelector("div.onm-anim-mask"))}}function showSkillCD(){if(!isCombat()){return}var g=document.querySelectorAll("[ability-id]");var e=[];for(var d=0;d<=3;d++){var h={skills:[]};for(var c=0;c<g.length;c++){if(g[c].outerHTML===document.querySelector("div.btn-usual-ok.btn-ability-use").outerHTML){}else{if((g[c].outerHTML.includes("ability-character-num-"+(d+1))===true)){if(!isNullOrUndefined(g[c].getAttribute("ability-recast"))){h.skills.push(g[c].getAttribute("ability-recast"))}}}}e.push(h)}var b=[];var l=document.querySelectorAll("div.prt-ability-state");for(var d=0;d<l.length;d++){if(d<=3){b.push(l[d])}}for(var d=0;d<b.length;d++){var f=0;var k=document.querySelectorAll("div.prt-ability-state")[d].childNodes;for(var c=0;c<k.length;c++){if((c%2)===1){var a=e[d].skills[f];if(!isNullOrUndefined(a)){if(a==="0"){a=""}k[c].innerHTML='<p style="position: relative;color:black;font-weight:bold;font-size: 6px;text-align: center;top: -4px;text-shadow: 0 0 10px #ffffff, 0 0 10px #ffffff;">'+a+"</p>"}f++}}}}function showBossHP(){if(!isCombat()){return}try{var b=stage.pJsnData.boss;var c=-1;document.querySelectorAll("div.prt-gauge-area")[0].childNodes.forEach(function(a,g){if(!isNullOrUndefined(a.className)&&a.classList.contains("prt-enemy-percent")){c++;var e=numberWithCommas(numberFormat(b.param[c].hp,1)+" / "+numberFormat(b.param[c].hpmax),1);var f=((b.param[c].hp/b.param[c].hpmax)*100).toFixed(1);var h=b.number;b.param.forEach(function(k,j){if(k.alive===0){h--}});if(h>1){a.childNodes[1].innerText=f+"%\n ("+e+")";a.childNodes[1].style.cssText="text-shadow: 0 0 1px #731400, 0 0 1px #731400, 0 0 1px #731400, 0 0 1px #731400, 0 0 2px #731400, 0 0 2px #731400, 0 0 2px #731400, 0 0 2px #731400; display: -webkit-box; margin: -34px 0 0 -20px; font-size:12px; width: 200px !important"}else{a.childNodes[1].innerText=f+"%	("+e+")";a.childNodes[1].style.cssText="text-shadow: 0 0 1px #731400, 0 0 1px #731400, 0 0 1px #731400, 0 0 1px #731400, 0 0 2px #731400, 0 0 2px #731400, 0 0 2px #731400, 0 0 2px #731400; display: -webkit-box; margin: -6px 0 0 70px; font-size:15px; width: 300px !important"}}})}catch(d){if(d instanceof ReferenceError){}}}var sSkill=[];var selectedCombatChara;document.addEventListener("click",function(a){if(isCombat()&&!isNullOrUndefined(a.target.parentNode)&&!isNullOrUndefined(a.target.parentNode.getAttribute("pos"))){selectedCombatChara={};sSkill=[];selectedCombatChara=a.target.parentNode;setCharaSkill(selectedCombatChara.getAttribute("pos"))}});document.addEventListener("keydown",function(j){if(j.which===32){var g=true;var h=document.querySelectorAll("textarea");for(var c=0;c<h.length;c++){if(!isNullOrUndefined(h[c].getAttribute("disabled")&&h[c].getAttribute("disabled")==true)){g=false}}if(!g){pSpaceBar(j);j.preventDefault();j.stopPropagation()}else{return true}}if(j.keyCode===67){pCA()}if(j.keyCode===82){pResetBonus()}if(j.key==="Escape"||j.key==="Esc"){if(!isCombat()){return}var f=document.querySelectorAll("div.btn-command-back");selectedCombatChara={};sSkill=[];if(f.length>0&&!isNullOrUndefined(f[0])){simulateClick(f[0])}}var b=[81,87,69,82];var d=[49,50,51,52];if(d.includes(j.keyCode)){if(!isCombat()){return}var a=d.indexOf(j.keyCode);shortcutSelectChara(a)}if(b.includes(j.keyCode)){if(!isCombat()){return}var a=b.indexOf(j.keyCode);shortcutSkill(a)}});function setCharaSkill(b){sSkill=[];var a=document.querySelectorAll("div.prt-ability-list")[b].childNodes;for(var c=0;c<a.length;c++){if(!isNullOrUndefined(a[c].className)&&a[c].className.includes("btn-ability")){sSkill.push(a[c])}}}function shortcutSelectChara(a){try{simulateClick(document.querySelectorAll("div.lis-character"+a+".btn-command-character")[0]);setCharaSkill(a)}catch(b){}}function shortcutSkill(a){try{if(sSkill[a].className.includes("btn-ability-available")){simulateClick(sSkill[a])}}catch(b){}}var observer=new MutationObserver(function(a){try{showSkillCD();showBossHP()}catch(b){if(b instanceof ReferenceError){}}});var config={attributes:true,childList:true,characterData:true};var ready=function(){if(isCombat()){var a=document.querySelectorAll("[ability-id]");if(document.querySelectorAll("[ability-id]").length>0&&document.querySelectorAll("div.prt-gauge-area")[0].childNodes.length>0){for(var b=0;b<document.querySelectorAll("[ability-id]").length;b++){observer.observe(document.querySelectorAll("[ability-id]")[b],{attributes:true,childList:true,characterData:true})}for(var b=0;b<document.querySelectorAll("[id^=enemy-hp]").length;b++){observer.observe(document.querySelectorAll("[id^=enemy-hp]")[b],{attributes:true,childList:true,characterData:true})}try{showSkillCD();showBossHP()}catch(c){if(c instanceof ReferenceError){}}}}else{if(window.location.href==="http://game.granbluefantasy.jp/#item"&&document.querySelectorAll("div.lis-item.se").length>0){return}}window.requestAnimationFrame(ready)};window.requestAnimationFrame(ready);
